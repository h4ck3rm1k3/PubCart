{% extends "home.html" %}
{% import 'macros.html' as macros %}
{% import "/snipets/addToTabButtons.html" as addToTab %}

{% block title %}
    My Tab - BournEE Exchange
{% endblock %}

{% block mediaScripts %}
{% endblock %}

{% block header %}{% endblock %}

{% block main_content %}
<div class='row'>
	<div class='span2'>
		<img class="img-rounded" data-src="holder.js/170x170/text:PubCart." alt="">
		{% if tab.pd %}
			<div class='pubcart_button marginTop15 marginBottom15 width_span2'>PAID - ${{tabPrice}}</div>
		{% else %}
			<button id='submitAddProductToTabForm' class="pubcart_button marginTop15 marginBottom15 width_span2" type="button">
				${{tabPrice}} pay tab.
			</button>
			{% if tab.owner %}
				<div class='cartInfoWrapper'>
					<div class='cartInfoTitle'>
						Bill to:
					</div>
					<div class='cartInfo'>
						{{tab.owner}}
					</div>
				</div>
			{% endif %}
			{% if tab.ud %}
				<div class='cartInfoWrapper'>
					<div class='cartInfoTitle'>
						Last updated:
					</div>
					<div class='cartInfo'>
						{{tab.ud}}
					</div>
				</div>
			{% endif %}
		{% endif %}
	</div>
	<div class='span8'>
		<header class='fullpageTitleWrapper'>
			<span class='muted'>Tab:</span>
			{% if tab.pd %}
				Paid <small>on {{tab.pdd}}</small>
			{% else %}
				Current (unpaid)
			{% endif %}
		</header>
		<section class='grandTotals'>
			<div class='row'>
				<div class='span2'>
					<div class='white_wrapper_box_span2'>
						<header class='tabCostSummaryHeader'>
							Sub-Total
						</header>
						<div class='tabCostSummaryText'>
							${{tab.d_st}}
						</div>		
					</div>
				</div>
				<div class='span2'>
					<div class='white_wrapper_box_span2'>
						<header class='tabCostSummaryHeader'>
							Shipping
						</header>
						<div class='tabCostSummaryText'>
							+ ${{tab.d_shc}}
						</div>	
					</div>
				</div>
				<div class='span2'>
					<div class='white_wrapper_box_span2'>
						<header class='tabCostSummaryHeader'>
							Taxes
						</header>
						<div class='tabCostSummaryText'>
							+ ${{tab.d_tx}}
						</div>	
					</div>
				</div>
				<div class='span2'>
					<div class='white_wrapper_box_span2'>
						<header class='tabCostSummaryHeader'>
							Grand-Total
						</header>
						<div class='tabCostSummaryText'>
							= ${{tab.d_gt}}
						</div>	
					</div>
				</div>
			</div>
		</section>
		<nav class='cartMenuWrapper'>
			<div class='subnavMenuItemWrapper'>
				<a id='fcEConvertToCartButton' class='btn-link subnavMenuItem'>Fork into Cart.</a>
			</div>
			<div class='subnavMenuItemWrapper'>
				<a id='fcAddProductButton' class='btn-link subnavMenuItem'>Add products.</a>
			</div>
		</nav>
		<div class='clearfix'></div>

			<!-- ################################ -->
			<!-- Beginning OF ADD PRODUCT WRAPPER -->
			<!-- ################################ -->
			<div id='addProductWrapper' class='addProductWrapper' style='display:none;'>
				<section class='white_wrapper_box_span8'>
					<header class='fullCart_popupFormsHeader'>Add products.</header>
					<form id="addProduct_form" class='nomargin_form' action="" method='POST'>
						<input type="hidden" name="exception" value="{{ exception }}">
						<input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
						<input type="hidden" name="tk" value="">
					  <div class="field_container product_number">
					    <label for="product_number" class="form_label label_small">Product Number</label>					
						{{ macros.field_no_label(addProductForm.productNumber, class="form_field field_small", placeholder='Manufacturer product number...') }}
					  </div>
					  <div class="field_container product_seller">
					    <label for="product_seller" class="form_label label_small">Product Seller</label>					
						{{ macros.field_no_label(addProductForm.urlsafeSellerKey, class="form_field field_small") }}
					  </div>
					  <button class="pubcart_button pubcart_button_medium" id="btn_addProduct" type="submit">Add product to cart.</button>

					  <div style="clear:both;"></div>
					</form>
				</section>
			</div>
			<!-- ########################## -->
			<!-- END OF ADD PRODUCT WRAPPER -->
			<!-- ########################## -->
			
			
			<!-- #################################### -->
			<!-- BEGINNING OF CONVERT TO CART WRAPPER -->
			<!-- #################################### -->
			<div id='convertWrapper' class='convertWrapper' style='display:none;'>
				<section class='white_wrapper_box_span8'>
					<header class='fullCart_popupFormsHeader'>Convert to a cart.</header>
					<form class='nomargin_form' action="" method='POST'>
						<input type="hidden" name="exception" value="{{ exception }}">
						<input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
						<input type="hidden" name="tk" value="">
		  				<button class="pubcart_button" id="btn_newCart" type="submit">Fork cart.</button>
		  				<div style="clear:both;"></div>
					</form>
				</section>
			</div>
			<!-- ################### -->
			<!-- END OF FORK WRAPPER -->
			<!-- ################### -->


			<section class='white_wrapper_box_span8'>
					{% block TabContent %}
						{% if tabOrders %}
							<table class="table table-striped table-hover table-condensed cartTable nomargin_table">
								<thead>
							        <tr>
										<th class="span1">Tab Qnt.</th>
							            <th class="span1">Img.</th>
										<th class="span2">Product.</th>
										<th class="span2">Seller.</th>
										<th class="span1">Popularity.</th>
										<th class="span1 right">Unit Price.</th>
							        </tr>
							    </thead>
								<tbody>
								    {% for order in tabOrders %}
										<tr>
											<td class='span1'>
												<form class='nomargin_form marginTop5' action="{{ uri_for('changeQntOfOrder')}}" method='POST'>
													<input type="hidden" name="exception" value="{{ exception }}">
										            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
										            <input type="hidden" name="park" value="{{ urlsafeTabKey }}">
										            <input type="hidden" name="ok" value="{{ order.key.urlsafe() }}">
													<input id='fullCart_itemQNT_update' rel='tooltip' data-original-title='Hit Enter' data-trigger='focus' name='qnt' type='text' class='span1 fullCart_itemQNT_update' value='{{order.q}}'>
												</form>
											</td>
											<td class='span1'>
												{% if order.fetch_img %}
													<img class="img-rounded" src="{{order.fetch_img}}" width='35px' alt="">
												{% else %}
													<img class="img-rounded" data-src="holder.js/35x35/text:PubCart." alt="">
												{% endif %}
											</td>
											<td class='span3'>
												<div id='{{order.productName}}_order_product_info_wrapper' class='order_product_info_wrapper'>
													<div class='order_pn_homepage'>
														<a href="{{uri_for('product', urlsafeProductKey=order.pk.urlsafe())}}">
															{{order.productName|truncate(length=19, killwords=True)}}
														</a>
													</div>
													<div class='order_name_homepage'>
														<a href="{{uri_for('product', urlsafeProductKey=order.pk.urlsafe())}}">
															{{order.description|truncate(length=19, killwords=True)}}
														</a>
													</div>
												</div>
											</td>
											<td class='span3'>
												{% if order.seller%}
													{{ order.seller }}
												{% endif %}
											</td>
											<td class='span2'>
												<div class="progress">
												  <div class="bar bar-success" style="width: {{ order.popularity }}%;"></div>
												</div>
												{% if order.savings %}
													<div class='cartRow_extraInfo green'>
														potential discount: <strong>{{order.savings}}% off</strong>
													</div>
												{% endif %}
											</td>
											<td class='span2 right'>
												<div class='small_buy_button_with_dropdown'>
													${{ order.d_bup }}
													<div class="btn-group">
														<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
															<span class="caret"></span>
														</button>
														<ul class="dropdown-menu pull-right">
															<li><a href="{{ uri_for('product', urlsafeProductKey=order.pk.urlsafe() ) }}">View Product</a></li>
														</ul>
													</div>
													<div class='clearfix'></div>
												</div>
												<div class='clearfix'></div>
												
												{% if order.q > 1 %}
												<div class='cartRow_extraInfo'>
													${{order.d_st}} @ {{order.q}}
												</div>
												{% endif %}
											</td>
										</tr>
									{% endfor %}
								</tbody>
								<tfoot>
									<tr>
										<td colspan='4'>Total unique items: {{tabOrders|count}}</td>
										<td colspan='2'><div class='textRight'>Tab sub-total: ${{tab.d_st}}</div></td>
									</tr>
								</tfoot>
							</table>
						{% else %}
							<div class="alert alert-info">
								<strong>Oh snap!</strong>You don't seem to have any orders in your cart.
							</div>
						{% endif %}
					{% endblock %}
			</section>
			
			<div class='clearfix'></div>
			
			{% if cartOwner %}
			<section>
				<div class="alert alert-info">
					<strong>Remove Items:</strong>  To remove an item from the tab, change it's quantity to 0.
				</div>
			</section>
			{% endif %}
	</div> <!-- End of Span8 -->
</div> <!-- End of Row -->
{% endblock %}
