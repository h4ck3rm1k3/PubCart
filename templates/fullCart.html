{% extends "home.html" %}
{% import 'macros.html' as lib with context %}

{% block title %}
    {{cart.n}} - BournEE Exchange
{% endblock %}

{% block mediaScripts %}
	{% if cart.public %}
		<script type="text/javascript">var switchTo5x=false;</script>
		<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
		<script type="text/javascript">stLight.options({publisher: "f8506e67-f112-448c-bfee-c3e10c576198", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>
	{% endif %}
{% endblock %}

{% block header %}{% endblock %}

{% block main_content %}
<div class='row'>
	<div class='span2'>
		{% if cart.img %}
			<img class="img-rounded" src="{{cart.img}}" width='170px' alt="{{cart.n}}">
		{% else %}
			<img class="img-rounded" data-src="holder.js/170x170/text:PubCart." alt="{{cart.n}}">
		{% endif %}
		<div id='addCartToTabButtonWrapper' class='addCartToTabButtonWrapper'>
			<form id='addCartToTabForm' name='addCartToTabForm' action="" method="POST">
		            <input type="hidden" name="exception" value="{{ exception }}">
		            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
					<input type="hidden" name="ck" value="{{cart.key.urlsafe()}}">
					<input type="hidden" name="uk" value="{{urlsafeUserKey}}">
					<div class="btn-group">
					<button id='submitAddToTabForm' class="pubcart_button marginTop15 width_span2" type="submit" form="addCartToTabForm" >${{cart.d_st}} - <small>put on Tab.</small></button></div>
			</form>
			

		</div>
	</div>
	<div class='span8'>
		<header class='fullpageTitleWrapper'>
			<span class='muted'>Cart:</span>
			{% set url= '/cart/'+ urlsafeCartKey %}
			{% if url in path or cart.n in path%}&nbsp;{{cart.n}}.&nbsp;&nbsp;
			{% else %}<a class='no_decoration' href='{{uri_for("fullPageCart",urlsafeCartKey=urlsafeCartKey)}}'>&nbsp;{{cart.n}}.&nbsp;&nbsp;</a>
			{% endif %}
			{% if not cart.public %}<span class="label label-warning">Private.</span>{% if cart.default %}&nbsp;&nbsp;<span class="label label-success">Default</span>{% endif %}{% else %}<span class="label label-success">Public.</span>
			{% endif %}
		</header>
		<article class='cartDescription'>
			<div class='muted'>Description:</div>
			<div>This is the projects description. You can read this to understand what all the items in the cart are for.</div>
		</article>
		<nav class='cartMenuWrapper'>
			{% if not cart.public %}
				<div class='subnavMenuItemWrapper'>
					<a href="{{ uri_for('makeCartPublic', urlsafeCartKey=urlsafeCartKey) }}" class='btn-link subnavMenuItem {% if "/makeCartPublic" in path %}active{% endif %}'>Take cart public.</a>
				</div>
				{% if '/makeCartPublic/' in path %}
					<div class='subnavMenuItemWrapper'>
						<a href="{{uri_for('fullPageCart',urlsafeCartKey=urlsafeCartKey)}}" class='btn-link subnavMenuItem'>Back to full cart.</a>
					</div>
				{% endif %}
			{% else %}
				<div class='subnavMenuItemWrapper'>
					<form id='addToWatchlistForm' name='addToWatchlistForm' action="{{ uri_for('addToWatchlist')}}" method="POST">
						<fieldset>
				            <input type="hidden" name="exception" value="{{ exception }}">
				            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
							<input type="hidden" name="pk" value="{{urlsafeCartKey}}">
							<input type="hidden" name="wln" value="ALL">
							<button type='submit' class="btn-link subnavMenuItem" >Watch.</button>
						</fieldset>
					</form>
				</div>
				<div class='subnavMenuItemWrapper'>
					<a id='fcShareButton' class='btn-link subnavMenuItem'>Share.</a>
				</div>
				<div class='subnavMenuItemWrapper'>
					<a id='fcEmbedButton' class='btn-link subnavMenuItem'>Embed.</a>
				</div>
			{% endif %}
			{% if '/makeCartPublic/' not in path %}
				{% if '/forkCart/' not in path %}
				<div class='subnavMenuItemWrapper'>
					<a id='fcForkButton' class='btn-link subnavMenuItem'>Fork.</a>
				</div>
				{% endif %}
				{% if cartOwner %}
					<div class='subnavMenuItemWrapper'>
						<a id='fcDetailsButton' class='btn-link subnavMenuItem'>Edit details.</a>
					</div>
					<div class='subnavMenuItemWrapper'>
						<a id='fcAddProductButton' class='btn-link subnavMenuItem {% if createCart %}active{% endif %}'>Add products.</a>
					</div>
				{% endif %}
			{% endif %}
		</nav>
		<div class='clearfix'></div>
		{% if cartOwner %}
			<section class="white_wrapper_box_span7" {% if not createCart %}style='display:none;'{% endif %}>
				<div id='addProductFormWrapper' class='pushUp'>
					<div class='form-horizontal'>
						<h4>Add product to this cart.</h4>
						<form class='nomargin_form' action="{{ uri_for('getProduct')}}" method='POST'>
							<fieldset>
					            <input type="hidden" name="exception" value="{{ exception }}">
					            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
					            <input type="hidden" name="ck" value="{{ urlsafeCartKey }}">
								{{ lib.field(addProductForm.productNumber, class="span6", maxlength="50", placeholder='Manufacturer Product Number', label=_("Product Number")) }}
								{{ lib.field(addProductForm.urlsafeSellerKey, class="span3", label=_("Product Seller *")) }}
								<button class='btn btn-primary pull-right' type='submit' >Add product.</button>
							</fieldset>
						</form>
					</div>
				</div>
			</section>
		{% endif %}
			<section class='white_wrapper_box_span7'>
								<div id='shareWrapper' class='shareWrapper' style='display:none;'>
									<div class='shareContent span3'>
										<h4>Share this cart.</h4>
										<p>What is Embed? Let's explain.</p>
									</div>
									<div class='shareForm pull-right span5'>
										<span class='st_facebook_large' displayText='Facebook'></span>
										<span class='st_twitter_large' displayText='Tweet'></span>
										<span class='st_googleplus_large' displayText='Google +'></span>
										<span class='st_blogger_large' displayText='Blogger'></span>
										<span class='st_wordpress_large' displayText='WordPress'></span>
										<span class='st_myspace_large' displayText='MySpace'></span>
										<span class='st_reddit_large' displayText='Reddit'></span>
										<span class='st_digg_large' displayText='Digg'></span>
										<span class='st_tumblr_large' displayText='Tumblr'></span>
										<span class='st_stumbleupon_large' displayText='StumbleUpon'></span>
										<span class='st_email_large' displayText='Email'></span>
										<div class='well well-small'>
										<p>Cart page link.</p>
										<input type='text' class='span4' value="http://www.pubCart.com{{uri_for('fullPublicCart', userID=cart.uk.id(), cartName=cart.n)}}"/></div>
									</div>
								</div>
								<div id='embedWrapper' class='embedWrapper' style='display:none;'>
									<div class='embedContent span3'>
										<h4>Embed on your site.</h4>
										<p>What is embed? Let's explain.</p>

									</div>
									<div class='embedForm well well-small span5 pull-right'>
										<textarea rows='6' class='span5'>Replace with embed code</textarea>
									</div>
								</div>
								{% if '/forkCart/' not in path %}
								<div id='forkWrapper' class='forkWrapper' style='display:none;'>
									<div class='forkContent span3'>
										<h4>Fork this cart.</h4>
										<p>What is a Fork? Let's explain.</p>
									</div>
									<div class='forkForm well well-small span5 pull-right form-horizontal'>
										<form class='nomargin_form' action="{{ uri_for('forkCart', urlsafeCartKey=urlsafeCartKey)}}" method='POST'>
											<fieldset>
									            <input type="hidden" name="exception" value="{{ exception }}">
									            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
									            <input type="hidden" name="ck" value="{{ urlsafeCartKey }}">
												{{ lib.field(forkCartForm.name, class="span3", maxlength="50", value='', placeholder='Max 50 characters', label=_("New Cart Name")) }}
												{{ lib.field(forkCartForm.description, class="span3", rows="3", maxlength="1000", placeholder='Max 1000 characters', label=_("Cart Description")) }}
												{{ lib.field(forkCartForm.category, class="span3", label=_("Cart Category")) }}
												<button class='btn btn-primary pull-right' type='submit' >Fork Cart</button>
											</fieldset>
										</form>
									</div>
								</div>
								{% endif %}
								{% if '/forkCart/' not in path %}
								<div id='detailsWrapper' class='detailsWrapper' style='display:none;'>
									<div class='detailsContent span3'>
										<h4>Edit cart details.</h4>
										<p>How to fill out the form.</p>
									</div>
									<div class='detailsForm well well-small span5 pull-right form-horizontal'>
										<form class='nomargin_form' action="{{ uri_for('editCartDetails', urlsafeCartKey=urlsafeCartKey)}}" method='POST'>
											<fieldset>
									            <input type="hidden" name="exception" value="{{ exception }}">
									            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
									            <input type="hidden" name="ck" value="{{ urlsafeCartKey }}">
												{{ lib.field(cartDetailsForm.description, class="span3", rows="3", maxlength="1000", placeholder='Max 1000 characters', label=_("Cart Description")) }}
												{{ lib.field(cartDetailsForm.category, class="span3", label=_("Cart Category")) }}
												<button class='btn btn-primary pull-right' type='submit' >Update Details</button>
											</fieldset>
										</form>
									</div>
								</div>
								{% endif %}


					{% block CartContent %}
						{% if productOrders %}
							<table class="table table-striped table-hover table-condensed cartTable">
								<thead>
							        <tr>
										<th class="span1">Cart Qnt.</th>
							            <th class="span1">Img.</th>
										<th class="span2">Product.</th>
										<th class="span2">Seller.</th>
										<th class="span1">Popularity</th>
										<th class="span1 right">Unit Price.</th>
							        </tr>
							    </thead>
								<tbody>
								    {% for order in productOrders %}
										<tr>
											<td class='span1'>
												<div class='qntNumber'>
												{{order.q}}
												</div>
												<div class='xSymbol'>x</div>
												<div class='clearfix'></div>
											</td>
											<td class='span1'>
												{% if order.img %}
													<img class="img-rounded" src="{{order.img}}" width='35px' alt="{{cart.n}}">
												{% else %}
													<img class="img-rounded" data-src="holder.js/35x35/text:PubCart." alt="{{cart.n}}">
												{% endif %}
											</td>
											<td class='span3'>
												<div id='{{order.pn}}_order_widget_info_wrapper_homepage' class='order_widget_info_wrapper_homepage'>
													<div class='order_pn_homepage'>
														{{order.productName|truncate(length=19, killwords=True)}}
													</div>
													<div class='order_name_homepage'>
														{{order.description|truncate(length=19, killwords=True)}}
													</div>
												</div>
											</td>
											<td class='span3'>
												{{ order.seller }}
											</td>
											<td class='span2'>
												<div class="progress">
												  <div class="bar bar-success" style="width: {{ order.popularity }}%;"></div>
												</div>
											</td>
											<td class='span2 right'>
												<div class="btn-group">
													<button class="btn btn-mini">${{order.d_bup}} Buy</button>
													<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
														<span class="caret"></span>
													</button>
													<ul class="dropdown-menu pull-right">
														<li><a href="{{ uri_for('product', urlsafeProductKey=order.pk.urlsafe() ) }}">View Product</a></li>
													</ul>
												</div>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
							
						{% else %}
							<div class="alert alert-info">
								<strong>Oh snap!</strong>You don't seem to have any orders in your cart.
							</div>
						{% endif %}
					{% endblock %}
			</section>
	</div> <!-- End of Span8 -->
</div> <!-- End of Row -->



	<div id='pageMessageWrapper' class='pageMessageWrapper'>
	{% block important %}
	{% endblock %}
	</div>
{% endblock %}

{% block top_right_aside %}
	<button class="btn btn-warning btn-large btn-block marginBottom15"><strong>Get this cart on your site</strong></button>
{% endblock %}


{% block extra_content %}{% endblock %}
